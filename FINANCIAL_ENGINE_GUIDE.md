# ๐ฐ ุงููุญุฑู ุงููุงูู ุงูุฌุฏูุฏ - ุฏููู ุดุงูู
## Financial Engine - Comprehensive Guide

ุชุงุฑูุฎ ุงูุชุญุฏูุซ: 17 ููููุจุฑ 2025
ุงููุณุฎุฉ: 3.0.0 - **ุงููุญุฑู ุงููุงูู**

---

## ๐ฏ ุงููุดููุฉ ุงูุชู ุชู ุญููุง

**ูุจู:** ูุญุฑู ุชุณุนูุฑ ุฃูุงุฏููู - ุฃุฑูุงู ุจุฏูู ูุนูู ูุงูู
**ุจุนุฏ:** ูุญุฑู ูุงูู ุญูููู - ูุฑุงุฑุงุช ูุจููุฉ ุนูู ุฃุฑูุงู ูุงุถุญุฉ

---

## โญ ูุง ุงูุฌุฏูุฏุ

### 1๏ธโฃ ุทุจูุฉ ุญุณุงุจุงุช ูุงููุฉ ูุดุชุฑูุฉ

ููู ุฌุฏูุฏ: `financial_engine.py`

**ูุญุชูู ุนูู 9 ุฏูุงู ุฃุณุงุณูุฉ:**

#### ุฃ) ุชุญููู ุงูุจูุงูุงุช ูู ุงููุตุงุฏุฑ
1. `load_pl_costs(pl_df)` - ุงุณุชุฎุฑุงุฌ ุงูุชูุงููู ูู P&L
2. `load_capacity(capacity_df)` - ุงุณุชุฎุฑุงุฌ ุงูุทุงูุฉ ุงูุฅูุชุงุฌูุฉ
3. `load_orders_stats(orders_df)` - ุฅุญุตุงุฆูุงุช ุงูุทูุจุงุช

#### ุจ) ุงูุญุณุงุจุงุช ุงููุงููุฉ
4. `compute_unit_cost(scenario, pl_costs)` - ุชูููุฉ ุงูุทูุจ ุญุณุจ ุงูุณููุงุฑูู
5. `suggest_price(cost, target_margin)` - ุงูุชุฑุงุญ ุงูุณุนุฑ
6. `calculate_margins(price, cost, volume)` - ุญุณุงุจ ุงูููุงูุด ูุงูุฃุฑุจุงุญ
7. `calculate_capacity_usage(orders, capacity)` - ูุณุจุฉ ุงุณุชุบูุงู ุงูุทุงูุฉ
8. `cost_per_capacity_unit(pl_costs, capacity)` - ุชูููุฉ ุงูุทุงูุฉ/ูุญุฏุฉ
9. `risk_warning(margin_pct, min_margin)` - ุชุญุฐูุฑุงุช ุงููุฎุงุทุฑ

#### ุฌ) ุชุญูููุงุช ูุชูุฏูุฉ
10. `price_elasticity_analysis()` - ุชุญููู ูุฑููุฉ ุงูุณุนุฑ
11. `enterprise_contract_analysis()` - ุชุญููู ุนููุฏ ุงููุคุณุณุงุช

---

## ๐ ุงูู 8 ูุคุดุฑุงุช ุงููุงููุฉ

### ุงูุชุณุนูุฑ ุงูุดุงูู ุงูุฌุฏูุฏ ูุนุฑุถ:

| # | ุงููุคุดุฑ | ุงููุนุงุฏูุฉ | ุงููุงุฆุฏุฉ |
|---|--------|----------|---------|
| 1๏ธโฃ | **ุชูููุฉ ุงูุทูุจ ุงูุญููููุฉ** | ุชูููุฉ ุงูุชุฌููุฒ + ุงูุชุฎุฒูู + ุงูุดุญู + ุงููุฑุชุฌุนุงุช + ุงูุนููููุฉ | ุชุนุฑู ุชูููุชู ุงููุนููุฉ ูู P&L + Capacity + Orders |
| 2๏ธโฃ | **ุณุนุฑ ุงูุจูุน ุงูููุชุฑุญ** | ุงูุชูููุฉ รท (1 - ูุงูุด ุงูุฑุจุญ%) | ุงูุณุนุฑ ุงููู ูุญูู ูุงูุดู ุงููุณุชูุฏู |
| 3๏ธโฃ | **ูุงูุด ุงูุฑุจุญ ุจุงูุฑูุงู** | ุณุนุฑ ุงูุจูุน - ุงูุชูููุฉ | ุงูุฑุจุญ ุงูุตุงูู ููุทูุจ ุงููุงุญุฏ |
| 4๏ธโฃ | **ูุงูุด ุงูุฑุจุญ ููุณุจุฉ** | (ุงูุฑุจุญ/ุทูุจ รท ุณุนุฑ ุงูุจูุน) ร 100 | ูุณุจุฉ ุงูุฑุจุญูุฉ |
| 5๏ธโฃ | **ุฑุจุญ ุดูุฑู ูุชููุน** | ุงูุฑุจุญ/ุทูุจ ร ุนุฏุฏ ุงูุทูุจุงุช | ุฏุฎูู ุงูุดูุฑู ุงููุชููุน |
| 6๏ธโฃ | **ุงุณุชุบูุงู ุงูุทุงูุฉ** | ุนุฏุฏ ุงูุทูุจุงุช รท ุงูุทุงูุฉ ุงููุตูู | ๐ข ุฃุฎุถุฑ / ๐ก ุฃุตูุฑ / ๐ด ุฃุญูุฑ |
| 7๏ธโฃ | **ุชูููุฉ ุงูุทุงูุฉ/ูุญุฏุฉ** | ุงูุชูุงููู ุงูุซุงุจุชุฉ รท ุงูุทุงูุฉ ุงููุตูู | ุชูููุฉ ุงูุทุงูุฉ ุงูููุฏุฑุฉ |
| 8๏ธโฃ | **ุชุญุฐูุฑ ูุฎุงุทุฑุฉ** | ุฅุฐุง Margin% < ุญุฏ ุฃุฏูู โ ุชุญุฐูุฑ | ุนุฑุถ ุนุงูู ุงููุฎุงุทุฑุฉ ุฃู ุขูู |

---

## ๐ ุฑุจุท ุงููุญุฑู ุจุงูุจูุงูุงุช

### ูู P&L (ููู ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ)

```python
pl_costs = fin_engine.load_pl_costs(pl_df)

# ูุณุชุฎุฑุฌ:
{
    'fulfillment_cost_per_order': 3.5,    # ูู "ูุตุงุฑูู ุชุฌููุฒ"
    'storage_cost_per_order': 1.5,         # ูู "ูุตุงุฑูู ุชุฎุฒูู"
    'shipping_cost_per_order': 10.0,       # ูู "ูุตุงุฑูู ุดุญู"
    'overhead_cost_per_order': 2.0,        # ูู "ุนููููุฉ ูุฅุฏุงุฑูุฉ"
    'total_monthly_expense': 60000,
    'order_count': 10000
}
```

**ููู ูุญุณุจุ**
- ูุจุญุซ ูู `Account Level 2` ุนู ุงููููุงุช ุงูููุชุงุญูุฉ
- ูุฌูุน ุงููุตุงุฑูู ููู ุจูุฏ
- ููุณู ุนูู ุนุฏุฏ ุงูุทูุจุงุช

### ูู ุดูุช ุงูุทุงูุฉ (Capacity)

```python
capacity_info = fin_engine.load_capacity(capacity_df)

# ูุณุชุฎุฑุฌ:
{
    'max_fulfillment_capacity': 50000,     # ุทูุจ/ุดูุฑ
    'max_storage_pallets': 468,            # ุทุจููุฉ
    'current_pallets_used': 250,
    'available_pallets': 218
}
```

### ูู ุจูุงูุงุช ุงูุทูุจุงุช (Orders)

```python
orders_stats = fin_engine.load_orders_stats(orders_df)

# ูุณุชุฎุฑุฌ:
{
    'total_orders': 16000,
    'monthly_orders': 1333,
    'inside_riyadh_orders': 8000,         # 50%
    'outside_riyadh_orders': 8000,
    'avg_order_weight': 2.5,
    'avg_skus_per_order': 3,
    'return_rate': 5.0,                    # ูุณุจุฉ ุงููุฑุชุฌุนุงุช
    'avg_processing_hours': 2.0
}
```

---

## ๐ก ุฃูุซูุฉ ุนูููุฉ

### ูุซุงู 1: ุชุณุนูุฑ ุดุญูุฉ ุฏุงุฎู ุงูุฑูุงุถ

```python
# ุงูุณููุงุฑูู
scenario = 'fulfillment_riyadh'
monthly_volume = 1000
target_margin = 25%

# 1๏ธโฃ ุญุณุงุจ ุงูุชูููุฉ
cost_breakdown = fin_engine.compute_unit_cost(
    scenario='fulfillment_riyadh',
    pl_costs=pl_costs,
    include_return_cost=True
)
# ุงููุชูุฌุฉ: 10.85 ุฑ.ุณ (ุชุฌููุฒ 3.5 + ุชุฎุฒูู 1.5 + ุดุญู 8 + ุนููููุฉ 2 + ูุฑุชุฌุนุงุช 0.5)

# 2๏ธโฃ ุณุนุฑ ุงูุจูุน ุงูููุชุฑุญ
pricing = fin_engine.suggest_price(10.85, 25)
# ุงููุชูุฌุฉ: 10.85 รท 0.75 = 14.47 ุฑ.ุณ

# 3๏ธโฃ ุงูููุงูุด
margins = fin_engine.calculate_margins(14.47, 10.85, 1000)
# ุงููุชูุฌุฉ:
# - ุฑุจุญ/ุทูุจ: 3.62 ุฑ.ุณ
# - ูุงูุด %: 25%
# - ุฑุจุญ ุดูุฑู: 3,620 ุฑ.ุณ

# 4๏ธโฃ ุงุณุชุบูุงู ุงูุทุงูุฉ
capacity = fin_engine.calculate_capacity_usage(1000, capacity_info)
# ุงููุชูุฌุฉ: 2% (1000 รท 50000) - ๐ข ููุชุงุฒ

# 5๏ธโฃ ุชุญุฐูุฑ ุงููุฎุงุทุฑุฉ
risk = fin_engine.risk_warning(25, 15, 25)
# ุงููุชูุฌุฉ: โ Safe - ูุงูุด ููุชุงุฒ
```

### ูุซุงู 2: ููุงุฑูุฉ CMA ูุน ุงูููุงูุณูู

```python
# ุฃุณุนุงุฑ ุงูููุงูุณูู
competitors = [12.0, 15.0, 13.5]
cost_per_order = 10.0

# ุชุญููู ูู ููุงูุณ
for price in competitors:
    margins = fin_engine.calculate_margins(price, cost_per_order, 1000)
    risk = fin_engine.risk_warning(margins['margin_percentage'], 15, 25)
    
    print(f"ุงูุณุนุฑ: {price} | ุงูุฑุจุญ: {margins['profit_per_order_sar']} | "
          f"Margin: {margins['margin_percentage']:.1f}% | "
          f"Risk: {risk['risk_level']}")

# ุงููุชูุฌุฉ:
# ุงูุณุนุฑ: 12.0  | ุงูุฑุจุญ: 2.0  | Margin: 16.7%  | Risk: moderate โ๏ธ
# ุงูุณุนุฑ: 15.0  | ุงูุฑุจุญ: 5.0  | Margin: 33.3%  | Risk: safe โ
# ุงูุณุนุฑ: 13.5  | ุงูุฑุจุญ: 3.5  | Margin: 25.9%  | Risk: safe โ

# ุงูุชูุตูุฉ: 13.5 ุฑ.ุณ (ุฃูู ุณุนุฑ ุขูู)
```

### ูุซุงู 3: ุชุญููู ูุฑููุฉ ุงูุณุนุฑ

```python
# ุฌุฑุจ 5 ุฃุณุนุงุฑ ูุฎุชููุฉ
analysis_df = fin_engine.price_elasticity_analysis(
    cost_per_order=10.0,
    base_volume=1000,
    price_range=(12.0, 18.0),
    elasticity=-0.5  # ูู 10% ุฒูุงุฏุฉ ุณุนุฑ = 5% ุงูุฎูุงุถ ูููุฉ
)

# ุงููุชูุฌุฉ:
# ุงูุณุนุฑ | ุงููููุฉ | ุงูุฅูุฑุงุฏ  | ุงูุชูููุฉ | ุงูุฑุจุญ   | ูุงูุด%
# 12.0  | 1125   | 13,500  | 11,250  | 2,250  | 16.7%
# 13.5  | 1031   | 13,919  | 10,310  | 3,609  | 25.9%  โ ุฃูุถู ุฎูุงุฑ
# 15.0  | 1000   | 15,000  | 10,000  | 5,000  | 33.3%
# 16.5  | 969    | 15,989  | 9,690   | 6,299  | 39.4%
# 18.0  | 875    | 15,750  | 8,750   | 7,000  | 38.9%
```

---

## ๐ฅ๏ธ ูุงุฌูุฉ ุงููุณุชุฎุฏู ุงูุฌุฏูุฏุฉ

### ๐ฐ ุงูุชุณุนูุฑ ุงูุดุงูู

**ุงููุฏุฎูุงุช:**
- ุงูุณููุงุฑูู (ุชุฌููุฒ + ุดุญู ุฏุงุฎู/ุฎุงุฑุฌ ุงูุฑูุงุถ)
- ุงูุญุฌู ุงูุดูุฑู
- ูุงูุด ุงูุฑุจุญ ุงููุณุชูุฏู
- ุงูุญุฏ ุงูุฃุฏูู ุงูููุจูู
- ุฅุถุงูุฉ ุชูููุฉ ุงููุฑุชุฌุนุงุช

**ุงููุฎุฑุฌุงุช:**
- 8 ููุงููุณ ูุงููุฉ ูู ุตู ูุงุญุฏ
- ุชูุงุตูู ุงูุชูููุฉ
- ูุนุงุฏูุฉ ุงูุชุณุนูุฑ
- ุชุญุฐูุฑุงุช ููููุฉ (๐ข/๐ก/๐ด)

### ๐ ุชุณุนูุฑ CMA

**ุงููุฏุฎูุงุช:**
- ุงูุณููุงุฑูู
- ุงูุญุฌู ุงูุดูุฑู
- ุฃุณุนุงุฑ 3 ููุงูุณูู
- ุงูุญุฏ ุงูุฃุฏูู ูููุงูุด

**ุงููุฎุฑุฌุงุช:**
- ุฌุฏูู ููุงุฑูุฉ ุดุงูู ููู ููุงูุณ:
  - ุงูุณุนุฑ | ุงูุชูููุฉ | ุงูุฑุจุญ/ุทูุจ | Margin% | ุฑุจุญ ุดูุฑู | ุฑุจุญ ุณููู | ุงูุชูููู
- ุงูุชูุตูุฉ ุงูุฐููุฉ (ุฃูู ุณุนุฑ ุขูู)
- ุฑุณู ุจูุงูู ููููุงุฑูุฉ
- ุชุญุฐูุฑุงุช ุฅุฐุง ูู ุงูุฃุณุนุงุฑ ููุฎูุถุฉ

---

## ๐ง ุงูุงุณุชุฎุฏุงู ูู ุงูููุฏ

### ูู ุฃู ุดุงุดุฉ ุชุณุนูุฑ:

```python
# 1. ุชุญููู ุงููุญุฑู ุงููุงูู
fin_engine = st.session_state.fin_engine

# 2. ุชุญููู ุงูุจูุงูุงุช
pl_df = db.load_dataframe('pnl')
capacity_df = db.load_dataframe('capacity')
orders_df = db.load_dataframe('orders')

# 3. ุงุณุชุฎุฑุงุฌ ุงูุชูุงููู
pl_costs = fin_engine.load_pl_costs(pl_df)
capacity_info = fin_engine.load_capacity(capacity_df)
orders_stats = fin_engine.load_orders_stats(orders_df)

# 4. ุญุณุงุจ ุงูุชูููุฉ
cost_breakdown = fin_engine.compute_unit_cost(
    scenario='fulfillment_riyadh',
    pl_costs=pl_costs
)

# 5. ุงูุชุฑุงุญ ุงูุณุนุฑ
pricing = fin_engine.suggest_price(
    cost_breakdown['total_cost_per_order'],
    target_margin=25
)

# 6. ุนุฑุถ ุงููุชุงุฆุฌ
st.metric("ุงูุชูููุฉ", cost_breakdown['total_cost_per_order'])
st.metric("ุงูุณุนุฑ", pricing['suggested_price'])
```

---

## ๐ ุงูููุงุฆุฏ ุงููุงููุฉ

### ูุจู (ุงููุธุงู ุงููุฏูู):
- โ ุฃุฑูุงู ุจุฏูู ูุนูู
- โ ูุง ุชุนุฑู ุงูุชูููุฉ ุงูุญููููุฉ
- โ ูุง ุชุนุฑู ุงูุฑุจุญ ุงููุชููุน
- โ ูุฑุงุฑุงุช ุนุดูุงุฆูุฉ

### ุจุนุฏ (ุงููุญุฑู ุงููุงูู):
- โ ุชูููุฉ ุฏูููุฉ ูู P&L
- โ ุณุนุฑ ูุญุณูุจ ุจุฏูุฉ
- โ ุฑุจุญ ูุชููุน ูุงุถุญ
- โ ุชุญุฐูุฑุงุช ููุฑูุฉ ูููุฎุงุทุฑ
- โ ูุฑุงุฑุงุช ูุจููุฉ ุนูู ุฃุฑูุงู ุญููููุฉ

---

## ๐ ุฃูุซูุฉ ุณููุงุฑูููุงุช

### ุณููุงุฑูู 1: ุนููู ุฌุฏูุฏ - 500 ุทูุจ ุดูุฑูุงู

```
ุงูุชูููุฉ ุงูุญููููุฉ:    10.50 ุฑ.ุณ
ุงูุณุนุฑ ุงูููุชุฑุญ (25%):  14.00 ุฑ.ุณ
ุงูุฑุจุญ/ุทูุจ:            3.50 ุฑ.ุณ
ุงูุฑุจุญ ุงูุดูุฑู:         1,750 ุฑ.ุณ
ุงูุฑุจุญ ุงูุณููู:         21,000 ุฑ.ุณ
ุงุณุชุบูุงู ุงูุทุงูุฉ:       1% ๐ข
ุงููุฎุงุทุฑุฉ:             โ Safe
```

### ุณููุงุฑูู 2: ููุงูุณุฉ ุดุฑุณุฉ - ุงุฎุชูุงุฑ ุงูุณุนุฑ

```
ููุงูุณ 1: 13 ุฑ.ุณ  โ Margin 19% โ๏ธ  | ุฑุจุญ ุดูุฑู 2,375
ููุงูุณ 2: 15 ุฑ.ุณ  โ Margin 30% โ  | ุฑุจุญ ุดูุฑู 4,500
ููุงูุณ 3: 14 ุฑ.ุณ  โ Margin 25% โ  | ุฑุจุญ ุดูุฑู 3,500

ุงูุชูุตูุฉ: 14 ุฑ.ุณ (ุฃูู ุณุนุฑ ุขูู + ุชูุงูุณู)
```

### ุณููุงุฑูู 3: ุทุงูุฉ ุดุจู ููุชูุฆุฉ

```
ุงูุญุฌู ุงููุชููุน:        45,000 ุทูุจ/ุดูุฑ
ุงูุทุงูุฉ ุงููุตูู:        50,000 ุทูุจ/ุดูุฑ
ุงุณุชุบูุงู ุงูุทุงูุฉ:       90% ๐ด
ุงูุทุงูุฉ ุงูููุฏุฑุฉ:       5,000 ุทูุจ
ุชูููุฉ ุงูุทุงูุฉ ุงูููุฏุฑุฉ: 10,000 ุฑ.ุณ

โ๏ธ ุชุญุฐูุฑ: ูุฌุจ ุฒูุงุฏุฉ ุงูุทุงูุฉ ูุฑูุจุงู!
```

---

## ๐ ููููุฉ ุงููุตูู

**ุงูุทุฑููุฉ:**
1. ุงูุชุญ ุงูุชุทุจูู: http://localhost:8509
2. ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ โ **๐ฐ ูุญุฑู ุงูุชุณุนูุฑ**
3. ุงุฎุชุฑ:
   - **๐ฐ ุชุณุนูุฑ ุดุงูู (ููุตู ุจู)** โ 8 ูุคุดุฑุงุช ูุงููุฉ
   - **๐ ุชุณุนูุฑ CMA** โ ููุงุฑูุฉ ุงูููุงูุณูู

---

## โ๏ธ ุฅุนุฏุงุฏุงุช ูุชูุฏูุฉ

### ุชุฎุตูุต ุงูุญุฏูุฏ:
- `target_margin` - ูุงูุด ุงูุฑุจุญ ุงููุณุชูุฏู (ุงูุชุฑุงุถู: 25%)
- `min_acceptable_margin` - ุงูุญุฏ ุงูุฃุฏูู (ุงูุชุฑุงุถู: 15%)
- `include_return_cost` - ุฅุถุงูุฉ ุชูููุฉ ุงููุฑุชุฌุนุงุช (ุงูุชุฑุงุถู: ูุนู)

### ุงูุณููุงุฑูููุงุช ุงููุฏุนููุฉ:
1. `fulfillment_riyadh` - ุชุฌููุฒ + ุดุญู ุฏุงุฎู ุงูุฑูุงุถ
2. `fulfillment_outside` - ุชุฌููุฒ + ุดุญู ุฎุงุฑุฌ ุงูุฑูุงุถ
3. `storage_only` - ุชุฎุฒูู ููุท
4. `shipping_riyadh` - ุดุญู ุฏุงุฎู ููุท
5. `shipping_outside` - ุดุญู ุฎุงุฑุฌ ููุท

---

## ๐ ููุงุญุธุงุช ูููุฉ

### ุฏูุฉ ุงูุญุณุงุจุงุช:
- ุงูุชูุงููู ุชูุญุณุจ ูู P&L **ุงููุนูู** ุงููุฑููุน
- ุฅุฐุง ูู ูุชู ุฑูุน P&L โ ูุณุชุฎุฏู ููู ุงูุชุฑุงุถูุฉ ูุนูููุฉ
- ุงูุทุงูุฉ ูู ุดูุช Capacity ุงููุฑููุน
- ูุนุฏู ุงููุฑุชุฌุนุงุช ูู ุจูุงูุงุช Orders ุงููุนููุฉ

### ุงูุชุญุฐูุฑุงุช ุงูุฐููุฉ:
- ๐ข **ุฃุฎุถุฑ** (< 60% ุงุณุชุบูุงู ุทุงูุฉ) - ููุชุงุฒ
- ๐ก **ุฃุตูุฑ** (60-85%) - ุชุญุฐูุฑ
- ๐ด **ุฃุญูุฑ** (> 85%) - ุฎุทุฑ

---

## ๐ฏ ุงูุฎุทูุงุช ุงููุงุฏูุฉ

### ูุฑูุจุงู:
- [ ] ุชุณุนูุฑ ุฏููุงูููู ูุน ุชุญููู ูุฑููุฉ ุงูุณุนุฑ
- [ ] ุชุณุนูุฑ ุงููุคุณุณุงุช ูุน ุงูุญุฏ ุงูุฃุฏูู ุงูุดูุฑู
- [ ] ููุงุฑูุฉ ุฌููุน ุงูููุงุฐุฌ ูู ุดุงุดุฉ ูุงุญุฏุฉ
- [ ] ุชุตุฏูุฑ ุงูุชุญููู ุฅูู Excel
- [ ] ุฑุณูู ุจูุงููุฉ ุชูุงุนููุฉ

---

**ุชู ุงูุชุทููุฑ ุจูุงุณุทุฉ:** ูุธุงู ูุชุงูู ููุชุณุนูุฑ ุงูุฐูู
**ุงููุณุฎุฉ:** 3.0.0 - ุงููุญุฑู ุงููุงูู
**ุงูุชุงุฑูุฎ:** 17 ููููุจุฑ 2025

โ **ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูููุฑู!**
